var yoffee=function(e){var t={};function o(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(exports,e,t){o.o(exports,e)||Object.defineProperty(exports,e,{enumerable:!0,get:t})},o.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t),o.d(t,"html",(function(){return D})),o.d(t,"createYoffeeElement",(function(){return n})),o.d(t,"YoffeeElement",(function(){return s}));class s extends HTMLElement{updateProp(e){let t=void 0===this[e]?this.getAttribute(e):this[e];this.props[e]=""===t||t}constructor(e){super(),this.props=this.props||{},this.state=e||{},[...this.attributes].forEach(e=>this.updateProp(e.name));new MutationObserver(e=>e.forEach(e=>{this.updateProp(e.attributeName),this.propUpdatedCallback&&this.propUpdatedCallback(e.attributeName)})).observe(this,{attributes:!0}),this.attachShadow({mode:"open"}),this._yoffeeFragment=this.render(),this.shadowRoot.appendChild(this._yoffeeFragment)}disconnectedCallback(){this._yoffeeFragment.__removeWatchers()}connectedCallback(){}propUpdatedCallback(){}}function n(e,t){if(t.prototype instanceof s)customElements.define(e,t);else{if(!(t instanceof Function))throw`YOFFEE: \`createYoffeeElement\` second parameter must be either a YoffeeElement subclass or a function, Got ${typeof renderCb}`;customElements.define(e,class extends s{render(){return t(this.props,this)}propUpdatedCallback(e){super.propUpdatedCallback(),this.onPropUpdate&&this.onPropUpdate(e)}connectedCallback(){super.connectedCallback(),this.onConnect&&this.onConnect()}disconnectedCallback(){super.disconnectedCallback(),this.onDisconnect&&this.onDisconnect()}})}}const i=new Map;function r(e,t,o){let s=i.get(e);null==s?(s=[{onGet:t,onSet:o}],i.set(e,s),function(e,t,o){const s={},n=n=>{Object.defineProperty(e,n,{get:()=>(t&&t(n),s[n]),set(e){s[n]=e,o&&o(n,e)}})},i=Object.getOwnPropertyDescriptors(e);for(let t of Object.keys(i))"__notWatchedProp"!==t&&(s[t]=e[t],n(t));Object.setPrototypeOf(e,new Proxy(s,{get(t,o){n(o),Reflect.get(e,o)},set:(t,o,s)=>(n(o),e[o]=s,!0)}))}(e,t=>s.forEach(o=>o.onGet(t,e)),(t,o)=>s.forEach(s=>s.onSet(t,o,e)))):s.push({onGet:t,onSet:o})}const l="Text/CSS node",a="Attribute value",d="Attribute name",h="HTML tag";function u(e,t){const o=[{type:l,xpath:`.//text()[contains(., '${t}')]`},{type:a,xpath:`.//@*[contains(., '${t}')]`},{type:d,xpath:`.//@*[contains(name(), '${t}')]`},{type:h,xpath:`.//*[contains(name(), '${t}')]`}];for(let t of o){let o=document.evaluate(t.xpath,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=o)return{domNode:o,searchLocation:t.type}}}function c(e,t){for(let o of t)e=e.replace(o.id,"${"+o._cb.toString()+"}");return e}function f(){return new Array(4).fill(0).map(()=>Math.random().toString(36).substr(2,9)).join("-")}function p(e,t,o){let s=e.get(t);null!=s?s.push(o):e.set(t,[o])}class m{constructor(e,t,o){this.expressions=e,this.domNode=t,this.expressionsLocation=o,this._arrayDomNodes=[],this.initialValue={[l]:()=>t.data,[a]:()=>t.value,[d]:()=>t.name}[o](),this.ownerElement=this.domNode.ownerElement}update(){this.expressionsLocation===l?this._updateTextNodeValue():this.expressionsLocation===a?this._updateAttributeNodeValue():this.expressionsLocation===d&&this._updateAttributeNodeName()}_updateTextNodeValue(){let e=this.expressions[0];if(e.cached)return;let t=e.lastResult;if(null!=t&&!1!==t||(t=""),this._lastTextNodeValue instanceof Array&&!(t instanceof Array)){for(let e of this._arrayDomNodes)this._removeDomNode(e);this._arrayDomNodes=[]}if(t instanceof DocumentFragment&&(t=0===t.childNodes.length?"":1===t.childNodes.length?t.firstChild:[...t.childNodes]),t instanceof Array){if(!(this._lastTextNodeValue instanceof Array)){let e=document.createElement("yoffee-list-location-marker");this.domNode.replaceWith(e),this.domNode=e}let e=[],o=null,s=e=>{null==o?null==this._arrayDomNodes[0]?this.domNode.parentNode.insertBefore(e,this.domNode):this.domNode.parentNode.insertBefore(e,this._arrayDomNodes[0].__isYoffee?this._arrayDomNodes[0].__childNodes[0]:this._arrayDomNodes[0]):this.domNode.parentNode.insertBefore(e,o.nextSibling),o=e.__isYoffee?e.__childNodes[e.__childNodes.length-1]:e};for(let n of t){if(null==n)continue;let t=this._arrayDomNodes[0];if(null!=t&&(t instanceof Text?t.data:t)===("number"==typeof n?n.toString():n))e.push(t),o=t.__isYoffee?t.__childNodes[t.__childNodes.length-1]:t,this._arrayDomNodes.shift();else if(n="object"==typeof n?n:document.createTextNode(n),e.push(n),n.__isYoffee)for(let e of n.__childNodes)s(e);else{if(n instanceof Array)throw"YOFFEE: List item cannot be another list";s(n)}}for(let t of this._arrayDomNodes)-1===e.indexOf(t)&&this._removeDomNode(t);this._arrayDomNodes=e}else if("object"==typeof t){if(!(t instanceof Node))throw"YOFFEE: Text value can't be a regular JS object!";this.domNode.replaceWith(t),this.domNode=t}else if("object"==typeof this._lastTextNodeValue){let e=document.createTextNode(t);this.domNode.replaceWith(e),this.domNode=e}else this.domNode.data!==t.toString()&&(this.domNode.data=t);this._lastTextNodeValue=t}_removeDomNode(e){if(e.__isYoffee)for(let t of e.__childNodes)t.remove();else e.remove()}_updateAttributeNodeValue(){if(this.expressions[0].isEventHandler){if(this.expressions.length>1){throw`YOFFEE: Cant have more than one expression as event handler: ${c(this.initialValue,this.expressions)}`}this._setEventListener()}else{let e=this.expressions[0].lastResult,t=1===this.expressions.length&&this.initialValue.length===this.expressions[0].id.length;if(!t||!1!==e&&null!=e)if(t&&["function","object"].includes(typeof e))_(this.ownerElement,this.domNode.name,e),null!=this.domNode.ownerElement&&this.domNode.ownerElement.removeAttributeNode(this.domNode);else if(t&&!0===e)this.ownerElement[this.domNode.name]=void 0,this._setDomNode("");else{this.ownerElement[this.domNode.name]=void 0;let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this._setDomNode(e)}else this.ownerElement[this.domNode.name]=void 0,this.ownerElement.removeAttribute(this.domNode.name)}}_setDomNode(e){this.domNode.value=e,null==this.domNode.ownerElement&&this.ownerElement.setAttributeNode(this.domNode)}_updateAttributeNodeName(){let e=this.expressions[0].lastResult,t=1===this.expressions.length&&this.initialValue.length===this.expressions[0].id.length;if(this._lastAttributeMap){for(let[e,t]of this._lastAttributeMap)this.ownerElement.removeAttribute(e),b(this.ownerElement,e);this._lastAttributeMap=null}else this.ownerElement.removeAttribute(this.domNode.name);if(!t||!1!==e&&null!=e&&""!==e)if(t&&"object"==typeof e){this._lastAttributeMap=Object.entries(e);for(let[e,t]of this._lastAttributeMap)!1!==t&&null!==t&&(["function","object"].includes(typeof t)?(_(this.ownerElement,e,t),null!=this.domNode.ownerElement&&this.domNode.ownerElement.removeAttributeNode(this.domNode)):(!0===t&&(t=""),this.ownerElement.setAttribute(e,t)))}else{let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this.ownerElement.setAttribute(e,this.domNode.value),this.domNode=this.ownerElement.getAttributeNode(e)}}_setEventListener(){let e=this.domNode.name,t=e.substring(2),o=(...e)=>{const t=this.expressions[0].lastResult(...e);return"function"==typeof t?t(...e):t};this.domNode.ownerElement.addEventListener(t,o),_(this.domNode.ownerElement,e,o),this.domNode.ownerElement.removeAttributeNode(this.domNode)}}function _(e,t,o){e[t]=o,e.updateProp?e.updateProp(t):(null==e.props&&(e.props={}),e.props[t]=o)}function b(e,t){e[t]=void 0,e.updateProp?e.updateProp(t):(null==e.props&&(e.props={}),e.props[t]=void 0)}function N(e,t){if(e.length!==t.length)return!1;for(let o=0;o<e.length;++o)if(e[o]!==t[o])return!1;return!0}const y="primitive",E="array",x="yoffee_template";class v{constructor(e){this._cb=e,this.id=f(),this.lastResult=null,this.boundNode=null,this.boundProps=new Set,this.isEventHandler=!1,this.isStatic="function"!=typeof this._cb,this.resultType=null,this.resultMetadata=null}execute(){if(this.cached=!1,this.isEventHandler||this.isStatic)this.lastResult=this._cb;else{let e=this._cb();null!=e&&e.createYoffeeTemplate?this.handleYoffeeTemplate(e):Array.isArray(e)?this.handleArray(e):(this.removeChildTemplateListeners(),this.lastResult=e,this.resultType=y,this.resultMetadata=null)}}handleYoffeeTemplate(e){var t,o,s,n;this.resultType===x&&null==this.resultMetadata.yoffeeTemplate||(this.resultType===x&&this.resultMetadata.cacheable&&(t=this.resultMetadata.hash,o=this.resultMetadata.propsObjs,s=e.hash,n=e.propsObjs,t===s&&N(o,n))?(this.cached=!0,this.lastResult.__expressions.forEach((t,o)=>{t._cb=e.expressionCbs[o]}),this.lastResult.__updateExpressions()):(this.removeChildTemplateListeners(),this.resultType=x,this.resultMetadata=e,this.lastResult=e.createYoffeeTemplate()))}handleArray(e){if(this.resultType===E){let t=this.resultMetadata;this.lastResult=[];let o=new Map;this.resultMetadata=o;for(let s of e)if(null!=s&&s.createYoffeeTemplate){let e=!1,n=t.get(s.hash);if(null!=n&&s.cacheable){let t=n.findIndex(e=>N(e.propsObjs,s.propsObjs));if(-1!==t){let i=n.splice(t,1)[0];e=!0,this.lastResult.push(i.yoffeeTemplate),i.shouldntDelete=!0,i.yoffeeTemplate.__expressions.forEach((e,t)=>{e._cb=s.expressionCbs[t]}),i.yoffeeTemplate.__updateExpressions(),p(o,i.hash,i)}}if(!e){p(o,s.hash,s);let e=s.createYoffeeTemplate();this.lastResult.push(e)}}else this.lastResult.push(s);for(let e of t.values())e.forEach(e=>{e.shouldntDelete||e.yoffeeTemplate.__removeWatchers()});for(let e of o.values())e.forEach(e=>{e.shouldntDelete&&(e.shouldntDelete=void 0)})}else{this.removeChildTemplateListeners(),this.lastResult=[];let t=new Map;for(let o of e)if(null!=o&&o.createYoffeeTemplate){let e=o.createYoffeeTemplate();this.lastResult.push(e),p(t,o.hash,o)}else this.lastResult.push(o);this.resultMetadata=t}this.resultType=E}removeChildTemplateListeners(){null!=this.resultType&&(this.resultType===x?this.resultMetadata.yoffeeTemplate.__removeWatchers():this.resultType===E&&this.lastResult.filter(e=>e.__isYoffee).forEach(e=>e.__removeWatchers()))}}function g(e,t){let o=e.data.trim(),s=o.indexOf(t),n=s+t.length;return 0!==s&&e.parentNode.insertBefore(document.createTextNode(o.substring(0,s)),e),n<o.length&&e.parentNode.insertBefore(document.createTextNode(o.substring(n)),e.nextSibling),e.data=o.substring(s,n),e}function w(e,t){return t.reduce((t,o,s)=>t+o+e[s+1],e[0]).split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)}let T=new Map,A=null,O=!1,P=new Set,S=null,j=(e,t)=>{if(!O)return;let o=`${t.__notWatchedProp}.${e}`;P.has(o)||(P.add(o),S.boundProps.add(o),T.has(o)||T.set(o,new Set),T.get(o).add(S))},C=(e,t,o)=>{if(O)throw`YOFFEE: Setting properties is not allowed inside an expression! (${e} = ${t})`;let s=`${o.__notWatchedProp}.${e}`,n=A;A=s;let i=T.get(A);null!=i&&(M([...i],!0),A=n)};const M=(e,t)=>{let o=O;O=!0;try{for(let o of e){o.boundProps.forEach(e=>T.get(e).delete(o));let e=new Set(P);t?P=new Set(o.__propsAccessedByFather||[]):o.__propsAccessedByFather=new Set(P);let s=S;S=o,o.execute(),S=s,P=e}}finally{O=o}for(let t of new Set(e.map(e=>e.boundNode)))t.update()};function Y(e,t,o){let s=document.createDocumentFragment();s.__isYoffee=!0;const n=o.map(e=>new v(e));var i;const r=function(e){let t=document.createElement("template");t.innerHTML=`<yoffee-template-container>${e.trim()}</yoffee-template-container>`;let o=t.content.firstElementChild;return navigator.userAgent.toLowerCase().indexOf("firefox")>-1?document.adoptNode(o):o}((i=t,n.map(e=>e.id).reduce((e,t,o)=>e+t+i[o+1],i[0])));return function(e,t){const o=new Map;for(let s of t){let t=null;if(t=u(e,s.id),null==t)throw`YOFFEE: Expression location is not valid: ${"${"+s._cb.toString()+"}"}`;let{domNode:n,searchLocation:i}=t;if(i===l&&(n=g(n,s.id)),i===h){throw`YOFFEE: Calculating element name is not allowed: ${c(`<${n.localName}>`,[s])}`}if(i===a&&n.name.startsWith("on")&&(s.isEventHandler=!0),o.has(n)){let e=o.get(n);e.expressions.push(s),s.boundNode=e}else{let e=new m([s],n,i);o.set(n,e),s.boundNode=e}}}(r,n),s.__removeWatchers=()=>{for(let e of n)e.boundProps.forEach(t=>T.get(t).delete(e)),e.removeChildTemplateListeners()},M(n),s.__childNodes=[...r.childNodes],s.__expressions=n,s.__updateExpressions=()=>M(n.filter(e=>!e.isStatic)),s.append(...r.childNodes),s}function D(...e){return e.forEach(e=>{if("object"!=typeof e)throw`YOFFEE: Props object must be an object, got ${typeof propsObject}`;if(null==e)throw"YOFFEE: Props object can't be null";null==e.__notWatchedProp&&(e.__notWatchedProp=f(),r(e,j,C))}),(t,...o)=>{let s=()=>Y(0,t,o);if(O){let n={propsObjs:e,expressionCbs:o,hash:w(t,o),cacheable:!1};return n.createYoffeeTemplate=()=>{let e=s();return n.yoffeeTemplate=e,e},n}return s()}}}]);let {html, YoffeeElement, createYoffeeElement} = yoffee; export {html, YoffeeElement, createYoffeeElement}
